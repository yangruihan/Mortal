<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>üÄÑÔ∏èMortal Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Mortal - a free and open source AI for Japanese mahjong">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">
        <link rel="stylesheet" href="css/mdbook-admonish.css">
        <link rel="stylesheet" href="css/extra.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Online Services</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Play with Mortal on Tenhou</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Online Log Reviewer</div></li><li class="chapter-item expanded affix "><li class="part-title">Performance</li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Comparison against Other AIs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Benchmarks</div></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="user/docker.html"><strong aria-hidden="true">5.</strong> Docker Quick Start</a></li><li class="chapter-item expanded "><a href="user/build.html"><strong aria-hidden="true">6.</strong> Build</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Training</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> Pre-Trained Model</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> Configurations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.</strong> Offline Phase</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.4.</strong> Online Phase</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> mjai</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Protocol Specification</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.2.</strong> Interface</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.3.</strong> Log Player</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Emulator</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> Mortal VS Mortal</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> Mortal VS akochan</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> Mortal VS MjaiLogEngine</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Components of Mortal</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Reinforcement Learning</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">11.1.</strong> Observation and Action Representations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.2.</strong> Network Structures</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.3.</strong> Environment and Reward Design</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.4.</strong> Training and Inference</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> libriichi - Mahjong Essentials in Rust</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">12.1.</strong> libriichi::state</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.2.</strong> libriichi::dataset</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.3.</strong> libriichi::algo</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.4.</strong> libriichi::agent</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.5.</strong> libriichi::arena</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.6.</strong> Executable Targets</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Comparison with Other AIs - Engineering-Wise</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> Failed Attempts</div></li><li class="chapter-item expanded "><a href="ref/meta.html"><strong aria-hidden="true">15.</strong> Meta</a></li><li class="chapter-item expanded affix "><li class="part-title">Contributor Guide</li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> How to Contribute</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">16.1.</strong> As a Data Scientist or Python Developer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.2.</strong> As a Rust Developer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.3.</strong> As a Designer or Front-End Developer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.4.</strong> As a Mahjong Player</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.5.</strong> As a Sponsor</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="contributors_sponsors.html">Contributors & Sponsors</a></li><li class="chapter-item expanded affix "><div>Donate‚ù§Ô∏è</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">üÄÑÔ∏èMortal Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Equim-chan/Mortal" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <p align="center">
  <img src="assets/logo.png"/>
</p>
<h1 id="mortal"><a class="header" href="#mortal">Mortal</a></h1>
<p><a href="https://github.com/Equim-chan/Mortal/actions"><img src="https://img.shields.io/github/workflow/status/Equim-chan/Mortal/build-libriichi?label=libriichi" alt="GitHub Workflow Status" /></a>
<a href="https://mortal.ekyu.moe"><img src="https://img.shields.io/github/workflow/status/Equim-chan/Mortal/deploy-docs?label=docs" alt="GitHub Workflow Status" /></a>
<a href="https://github.com/Equim-chan/Mortal/blob/main/LICENSE"><img src="https://img.shields.io/github/license/Equim-chan/Mortal" alt="" /></a></p>
<p><img src="https://img.shields.io/github/languages/top/Equim-chan/Mortal" alt="GitHub top language" />
<img src="https://img.shields.io/tokei/lines/github/Equim-chan/Mortal" alt="Lines of code" />
<img src="https://img.shields.io/github/languages/code-size/Equim-chan/Mortal" alt="GitHub code size in bytes" /></p>
<p>Mortal (<a href="https://www.mdbg.net/chinese/dictionary?wdqb=%E5%87%A1%E5%A4%AB">Âá°Â§´</a>) is a free and open source AI for Japanese mahjong, powered by deep reinforcement learning.</p>
<p>The development of Mortal is hosted on GitHub at <a href="https://github.com/Equim-chan/Mortal">https://github.com/Equim-chan/Mortal</a>.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
A strong mahjong AI that is compatible with Tenhou's standard ranked rule for four-player mahjong.</li>
<li><input disabled="" type="checkbox" checked=""/>
A blazingly fast mahjong emulator written in Rust with a Python interface. Up to 23K hanchans per hour<sup class="footnote-reference"><a href="#env">1</a></sup> can be achieved using the Rust emulator combined with Python neural network inference.</li>
<li><input disabled="" type="checkbox" checked=""/>
An easy-to-use mjai interface.</li>
<li><input disabled="" type="checkbox" checked=""/>
Free and open source.</li>
</ul>
<div class="admonition note">
<div class="admonition-title">
<p>WIP features</p>
</div>
<div>
<ul>
<li><input disabled="" type="checkbox"/>
Serve as a backend for mjai-reviewer (formerly known as akochan-reviewer).</li>
<li><input disabled="" type="checkbox"/>
Limited reasoning support.</li>
</ul>
</div>
</div>
<h2 id="about-this-doc"><a class="header" href="#about-this-doc">About this doc</a></h2>
<p><strong>This doc is work in progress, so most pages are empty right now.</strong></p>
<h2 id="okay-cool-now-give-me-the-weights"><a class="header" href="#okay-cool-now-give-me-the-weights">Okay cool now give me the weights!</a></h2>
<p>Read <a href="https://gist.github.com/Equim-chan/cf3f01735d5d98f1e7be02e94b288c56">this post</a> for details regarding this topic.</p>
<p>As planned, the trained model will be released after I add Mortal support to <a href="https://github.com/Equim-chan/akochan-reviewer">akochan-reviewer</a>, which will then be renamed to mjai-reviewer.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<h3 id="code"><a class="header" href="#code">Code</a></h3>
<p><a href="https://github.com/Equim-chan/Mortal/blob/main/LICENSE"><img src="assets/agpl.png" alt="AGPL-3.0-or-later" /></a></p>
<p>Copyright (C) 2021-2022 Equim</p>
<p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.</p>
<p>You should have received a copy of the GNU Affero General Public License along with this program. If not, see <a href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.</p>
<h3 id="logo-and-other-assets"><a class="header" href="#logo-and-other-assets">Logo and Other Assets</a></h3>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="assets/by-sa.png" alt="CC BY-SA 4.0" /></a></p>
<div class="footnote-definition" id="env"><sup class="footnote-definition-label">1</sup>
<p>Measured on NVIDIA¬Æ GeForce¬Æ RTX 2060 SUPER‚Ñ¢ with AMD Ryzen‚Ñ¢ 5 3600, game batch size 2000.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-quick-start"><a class="header" href="#docker-quick-start">Docker Quick Start</a></h1>
<p>A handy <code>Dockerfile</code> has been added to the project for an easy and quick start.</p>
<div class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
</div>
<div>
<p>This Docker image is only designed for inference with mjai interface and is not targeted for training.</p>
</div>
</div>
<h2 id="build"><a class="header" href="#build">Build</a></h2>
<pre><code class="language-shell">$ git clone https://github.com/Equim-chan/Mortal.git
$ cd Mortal
$ sudo env DOCKER_BUILDKIT=1 docker build -t mortal:latest .
</code></pre>
<h2 id="prepare-a-trained-model"><a class="header" href="#prepare-a-trained-model">Prepare a trained model</a></h2>
<p>The Docker image does not contain any model file of Model, therefore it must be prepared separately under a directory, which will be demostrated as <code>/path/to/model/dir</code> below. In this example, snapshot <code>22040703</code> is used.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>We are going to use Mortal to evaluate the next move for the scene shown in <em>Figure 1</em>.</p>
<p><img src="user/../assets/docker_1.png" alt="" /></p>
<p class="caption">Figure 1</p>
<p>First things first, we need to identify the POV's player ID. A player ID is an immutable number that identifies a specific player throughout one game. The rule is simple, the player sitting at the East at E1 is 0, and his shimocha (right) will be 1, toimen (across) will be 2, kamicha (left) will be 3. This works exactly the same as the <code>tw</code> parameter in Tenhou's log URL.</p>
<p>In this case, the POV's player ID is 2, because his seat is West at E1.</p>
<p>Mortal speaks mjai <!-- TODO: link to doc -->, a simple and easy-to-read stream format for mahjong records. From the perspective of player 2, the equivalant masked mjai events he has perceived so far are:</p>
<pre><code class="language-js">{&quot;type&quot;:&quot;start_game&quot;}
{&quot;type&quot;:&quot;start_kyoku&quot;,&quot;bakaze&quot;:&quot;E&quot;,&quot;dora_marker&quot;:&quot;3s&quot;,&quot;kyoku&quot;:3,&quot;honba&quot;:0,&quot;kyotaku&quot;:0,&quot;oya&quot;:2,&quot;scores&quot;:[22000,23700,26000,28300],&quot;tehais&quot;:[[&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;],[&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;],[&quot;1m&quot;,&quot;1m&quot;,&quot;4m&quot;,&quot;5m&quot;,&quot;1p&quot;,&quot;5p&quot;,&quot;8p&quot;,&quot;1s&quot;,&quot;4s&quot;,&quot;4s&quot;,&quot;6s&quot;,&quot;8s&quot;,&quot;N&quot;],[&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;,&quot;?&quot;]]}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;6p&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;1s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;1s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;9s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;9p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;3s&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;N&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;9m&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;1m&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;1s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;7s&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;1p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;W&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;1p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;W&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;pon&quot;,&quot;actor&quot;:0,&quot;target&quot;:1,&quot;pai&quot;:&quot;W&quot;,&quot;consumed&quot;:[&quot;W&quot;,&quot;W&quot;]}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;2p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;9s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;P&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;8p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;C&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;9p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;1s&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;7m&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;7m&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;7p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;C&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;2s&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;6s&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;6s&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;E&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;pon&quot;,&quot;actor&quot;:1,&quot;target&quot;:3,&quot;pai&quot;:&quot;E&quot;,&quot;consumed&quot;:[&quot;E&quot;,&quot;E&quot;]}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;2m&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;7p&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;P&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;8s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;E&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;4p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;8p&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;8p&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;9s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;S&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;6s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;9m&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;9m&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;2p&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;2s&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;8p&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;F&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;F&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;4p&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;4m&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;S&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;5mr&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;5m&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;reach&quot;,&quot;actor&quot;:3}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;N&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;reach_accepted&quot;,&quot;actor&quot;:3}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;N&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;F&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;9p&quot;}
</code></pre>
<p>Save the mjai log content above into a file named <code>log.json</code>, then run:</p>
<pre><code class="language-shell">$ sudo docker run -i --rm -v /path/to/model/dir:/mnt mortal 2 &lt; log.json
</code></pre>
<p>This will output a series of new-line-separated JSONs, each of which represents Mortal's reaction to an mjai event that it is able to react to, with the last line corresponding to the scene illustrated above:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;dahai&quot;,
  &quot;actor&quot;: 2,
  &quot;pai&quot;: &quot;9p&quot;,
  &quot;tsumogiri&quot;: true,
  &quot;meta&quot;: {
    &quot;q_values&quot;: [
      -1.1929103,
      -1.5628747,
      -1.6204606,
      -1.607082,
      -1.3267958,
      -0.2436666,
      -1.5208447,
      -1.5280346,
      -1.5830542,
      -1.6640469,
      -1.1801766,
      -1.8054415
    ],
    &quot;mask_bits&quot;: 17241923593,
    &quot;is_greedy&quot;: true,
    &quot;batch_size&quot;: 1,
    &quot;eval_time_ns&quot;: 30352000
  }
}
</code></pre>
<p>From the JSON output we can clearly read that Mortal would like to discard 9p in this scene.</p>
<div class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<div>
<p>The field <code>meta</code> is not defined in mjai and is completely optional. In Mortal, this field is used to record metadata such as its network's raw outputs and evaluation time.</p>
</div>
</div>
<p>Don't shut down the process yet. Now let's go one turn further. The player discarded 9p, passed a 1m pon, and here it comes the next scene:</p>
<p><img src="user/../assets/docker_2.png" alt="" /></p>
<p class="caption">Figure 2</p>
<p>The mjai events the player perceived since <em>Figure 1</em> are:</p>
<pre><code class="language-js">{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;9p&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:3,&quot;pai&quot;:&quot;2p&quot;,&quot;tsumogiri&quot;:true}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:0,&quot;pai&quot;:&quot;8s&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;?&quot;}
{&quot;type&quot;:&quot;dahai&quot;,&quot;actor&quot;:1,&quot;pai&quot;:&quot;1m&quot;,&quot;tsumogiri&quot;:false}
{&quot;type&quot;:&quot;tsumo&quot;,&quot;actor&quot;:2,&quot;pai&quot;:&quot;3p&quot;}
</code></pre>
<p>Paste them into the running process's input (or just append these to <code>log.json</code> and re-run the command), and we will get Mortal's reactions to them.</p>
<p>First, there will be a <code>none</code> type action, which means Mortal would pass the 1m pon:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;none&quot;,
  &quot;meta&quot;: {
    &quot;q_values&quot;: [
      -1.2190987,
      -0.084070235
    ],
    &quot;mask_bits&quot;: 37383395344384,
    &quot;is_greedy&quot;: true,
    &quot;batch_size&quot;: 1,
    &quot;eval_time_ns&quot;: 29667100
  }
}
</code></pre>
<p>Then a <code>dahai</code> event will follow, which corresponds to the scene in <em>Figure 2</em>:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;dahai&quot;,
  &quot;actor&quot;: 2,
  &quot;pai&quot;: &quot;1m&quot;,
  &quot;tsumogiri&quot;: false,
  &quot;meta&quot;: {
    &quot;q_values&quot;: [
      -0.22652823,
      -1.7668037,
      -1.0071788,
      -1.7482929,
      -1.7783809,
      -1.5943735,
      -1.5575972,
      -1.5641792,
      -1.6780779,
      -1.7836256,
      -1.5739789,
      -1.915102
    ],
    &quot;mask_bits&quot;: 17241794569,
    &quot;is_greedy&quot;: true,
    &quot;batch_size&quot;: 1,
    &quot;eval_time_ns&quot;: 29686500
  }
}
</code></pre>
<p>We can tell that Mortal would choose to discard 1m at this point.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-1"><a class="header" href="#build-1">Build</a></h1>
<h2 id="build-required-components"><a class="header" href="#build-required-components">Build required components</a></h2>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<p>To build and use Mortal, you need to have a Python environment and an up-to-date Rust compiler. If you plan to train, make sure you have a GPU installed.</p>
<p>It is recommended to use <a href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a> and <a href="https://rustup.rs/">rustup</a> to setup the environment.</p>
<p>Instructions below will assume you already have miniconda and Rust installed.</p>
<h3 id="clone"><a class="header" href="#clone">Clone</a></h3>
<pre><code class="language-shell">$ git clone https://github.com/Equim-chan/Mortal.git
$ cd Mortal
</code></pre>
<p>From now on, the root directory of Mortal will be demostrated as <code>$MORTAL_ROOT</code>.</p>
<h3 id="create-and-activate-a-conda-env"><a class="header" href="#create-and-activate-a-conda-env">Create and activate a conda env</a></h3>
<blockquote>
<p>Working directory: <code>$MORTAL_ROOT</code></p>
</blockquote>
<pre><code class="language-shell">$ conda env create -f environment.yml
$ conda activate mortal
</code></pre>
<h3 id="install-pytorch"><a class="header" href="#install-pytorch">Install pytorch</a></h3>
<p>pytorch is not listed as a dependency in <code>environment.yml</code> on purpose so that users can install it with their favored ways as per their requirement, hardware and OS.</p>
<p>Check <a href="https://pytorch.org/get-started/locally/">pytorch's doc</a> on how to install pytorch in your environment. Personally, I recommand installing pytorch with pip.</p>
<div class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
</div>
<div>
<p>Only <code>torch</code> is needed. You can skip the installation of <code>torchvision</code> and <code>torchaudio</code>.</p>
</div>
</div>
<h3 id="build-and-install-libriichi"><a class="header" href="#build-and-install-libriichi">Build and install libriichi</a></h3>
<blockquote>
<p>Working directory: <code>$MORTAL_ROOT</code></p>
</blockquote>
<pre><code class="language-shell">$ cargo build --lib --release
</code></pre>
<p>For Linux</p>
<pre><code class="language-shell">$ cp target/release/libriichi.so mortal/libriichi.so
</code></pre>
<p>For Windows (MSYS2)</p>
<pre><code class="language-shell">$ cp target/release/riichi.dll mortal/libriichi.pyd
</code></pre>
<h3 id="test-the-environment"><a class="header" href="#test-the-environment">Test the environment</a></h3>
<blockquote>
<p>Working directory: <code>$MORTAL_ROOT/mortal</code></p>
</blockquote>
<pre><code class="language-shell">$ python
Python 3.9.7 | packaged by conda-forge | (default, Sep 29 2021, 19:23:11)
[GCC 9.4.0] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import libriichi
&gt;&gt;&gt; help(libriichi)
</code></pre>
<h2 id="build-executable-utilities"><a class="header" href="#build-executable-utilities">Build executable utilities</a></h2>
<blockquote>
<p>Working directory: <code>$MORTAL_ROOT</code></p>
</blockquote>
<pre><code class="language-shell">$ cargo build --bins --no-default-features --release
</code></pre>
<h2 id="build-documentation"><a class="header" href="#build-documentation">Build documentation</a></h2>
<blockquote>
<p>Working directory: <code>$MORTAL_ROOT/docs</code></p>
</blockquote>
<pre><code class="language-shell">$ cargo install mdbook mdbook-admonish mdbook-pagetoc
$ mdbook build
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="meta"><a class="header" href="#meta">Meta</a></h1>
<h2 id="what-does-the-name-mortal-mean"><a class="header" href="#what-does-the-name-mortal-mean">What does the name &quot;Mortal&quot; mean?</a></h2>
<p>Mortal in this context means something opposed to supernatural or immortal.</p>
<p>There is no superpower in mahjong, nor any supernatural &quot;fate's bless&quot; to be relied on. Everyone is &quot;mortal&quot; and the AI is no different.</p>
<p>What the AI does is merely believing exclusively in the grand truth and never become emotional, with enough learning and practice and that's it. I've always believed that one of the reasons why many human players cannot defeat AIs in mahjong is that they are prone to becoming emotional, leading to minor but often fatal mistakes, which sometimes the players themselves deny to admit and blame on luck instead.</p>
<p>I got the inspiration from Kajiki Yumi, a character from Saki. She is indeed a mortal compared with other opponents she has played against, yet she tried her best as a mortal fighting for her own objective. &quot;kajusan&quot; was one of the names I have thought of, but I thought there were already a few mahjong projects based on character names from Saki.</p>
<p>I had a hard time thinking for a name. The project started with &quot;OpenPhoenix&quot;, because it was at first a reproduction of Suphx, but after I changed many parts of it, it became less and less alike to Suphx, then I renamed it to &quot;Reishanten&quot;. In the end, I thought the name was too hard to read and get its meaning, I came up with the name &quot;Mortal&quot;.</p>
<h2 id="when-was-the-project-started"><a class="header" href="#when-was-the-project-started">When was the project started?</a></h2>
<p>The project started on 2021-04-24. A prototype of <code>PlayerState</code> was made that day.</p>
<h2 id="why-agpl"><a class="header" href="#why-agpl">Why AGPL?</a></h2>
<p>First of all, it is because the shanten algorithm (<code>/libriichi/src/algo/shanten.rs</code>) is a Rust port of <a href="https://github.com/tomohxx/shanten-number-calculator">tomohxx/shanten-number-calculator</a>, which is licensed under GPL. As for the reason for it to be <strong>A</strong>GPL, my consideration is this project is natually easy to be exploited, such as being used for cheats or getting renamed then sold to unaware people, so even if I can't <em>really</em> stop such exploit, at least I want to do my part and make my attempt on what I can to stop this.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="founders-and-original-authors"><a class="header" href="#founders-and-original-authors">Founders and original authors</a></h1>
<ul>
<li><a href="https://github.com/Equim-chan">Equim-chan</a></li>
<li><a href="https://github.com/OceanLight">OceanLight</a></li>
</ul>
<h1 id="contributors"><a class="header" href="#contributors">Contributors</a></h1>
<p><em>Nobody yet.</em></p>
<h1 id="sponsors"><a class="header" href="#sponsors">Sponsors</a></h1>
<ul>
<li>KY&amp;DEP (<a href="https://twitter.com/EDWARDH_Jantama">EDWARDH</a>)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="theme/pagetoc.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
